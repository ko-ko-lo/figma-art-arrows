<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Artsy Arrows Plugin</title>
    <style>
      :root {
        --bg-color-button-hover: white;
        --hover-bg: #8b8c89;
        --bg-color-button: #f2f2f2;
        --color-border: #9eb2bc;
        --border-radius-button: 8px;
        --border-radius-tab: 999px;
        --hover-scale: 1.08;
        --transition-speed: 0.3s;
        --size-10: 10px;
        --size-16: 16px;
        --size-24: 24px;
        --size-32: 32px;
        --size-40: 40px;
      }

      body {
        margin: var(--size-16);
      }

      #arrowList {
        display: flex;
        gap: var(--size-16);
        flex-wrap: wrap;
      }

      div.arrow {
        width: 225px;
        height: 225px;
      }

      .arrow {
        cursor: pointer;
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius-button);
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--bg-color-button);
        transition: transform var(--transition-speed),
          box-shadow var(--transition-speed);
      }

      .arrow:hover {
        background-color: var(--bg-color-button-hover);
        transition: transform var(--transition-speed);
      }

      #colorPicker {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: var(--size-16);
      }

      .color-circle {
        width: var(--size-40);
        height: var(--size-40);
        border-radius: 50%;
        cursor: pointer;
      }

      .selected {
        border: 1px solid var(--hover-bg);
      }

      svg {
        padding: var(--size-24);
      }
    </style>
  </head>
  <body>
    <div id="colorPicker"></div>
    <div id="arrowList"></div>

    <script>
      const colorPicker = document.getElementById("colorPicker");

      const ColorCombinations = [
        { name: "Rose Pink", color: "#E8759F" },
        { name: "Mint Leaf", color: "#66CDAA" },
        { name: "Sky Teal", color: "#5EC8C8" },
        { name: "Orchid Purple", color: "#A178C4" },
        { name: "Sunbeam Yellow", color: "#F6D167" },
        { name: "Coral Peach", color: "#F99F7C" },
        { name: "Neutral Ground", color: "#4A4A4A" },
      ];

      let selectedColor = ColorCombinations[6];

      /* ------------------------------------------------------------------
      Send request for arrows to code.ts when the UI loads
      ------------------------------------------------------------------ */

      window.onload = () => {
        parent.postMessage({ pluginMessage: { type: "request-arrows" } }, "*");
        createColorPicker();
      };

      /* ------------------------------------------------------------------
      Handle incoming messages from code.ts
      ------------------------------------------------------------------ */

      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (!msg) return;

        if (msg.type === "load-arrows") {
          const arrowList = document.getElementById("arrowList");

          Object.entries(msg.arrows).forEach(([key, svg]) => {
            const div = document.createElement("div");
            div.classList.add("arrow");
            div.innerHTML = svg;

            div.addEventListener("click", () => {
              parent.postMessage(
                {
                  pluginMessage: {
                    type: "insert-arrow",
                    arrowType: key,
                  },
                },
                "*"
              );
            });

            arrowList.appendChild(div);
          });
        }
      };

      /* ------------------------------------------------------------------
      Create Color Picker
      ------------------------------------------------------------------ */
      function createColorPicker() {
        ColorCombinations.forEach((color) => {
          const colorDiv = document.createElement("div");
          colorDiv.classList.add("color-circle");
          colorDiv.style.backgroundColor = color.color;
          colorDiv.title = color.name;

          colorDiv.addEventListener("click", () => {
            selectedColor = color;
            document
              .querySelectorAll(".color-circle")
              .forEach((c) => c.classList.remove("selected"));
            colorDiv.classList.add("selected");

            // Apply selected color to all arrows
            document.querySelectorAll(".arrow svg path").forEach((path) => {
              path.setAttribute("fill", selectedColor.color);
            });
          });

          colorPicker.appendChild(colorDiv);
        });
      }
    </script>
  </body>
</html>
